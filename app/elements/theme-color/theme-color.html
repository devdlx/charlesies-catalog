<script src="../../bower_components/color/one-color.js"></script>
<dom-module id="theme-color">

  <style>
    :host {
      /*overflow: visible;*/
      height: 100%;
      width: 100%;
      display: block;
      /*background-color: var(--theme-background-color);
      background-image: var(--theme-image);
      background-size: cover;*/
    }

    ::content [themed] {
      background-color: var(--theme-background-color);
      color: var(--theme-color);
    }

    ::content [themed-color] {
      color: var(--theme-background-color);
    }

    ::content [themed-color-bg] {
      background-color: var(--theme-background-color);
    }

    ::content [themed-image]:before {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      /* z-index: -1; */
      display: block;
      background-size: contain;
      /*-webkit-filter: blur(8px);
      -moz-filter: blur(5px);
      -o-filter: blur(5px);
      -ms-filter: blur(5px);
      filter: blur(5px);*/
      bottom: 0;
      background-image: var(--theme-image);
      background-size: cover;
    }
  </style>
  <template>
    <content></content>
  </template>

  <script>
    Polymer({
      is: 'theme-color',
      enableCustomStyleProperties: true,
      properties: {
        color: {
          type: String,
          notify: true
        },
        textColor: {
          type: String,
          notify: true,
          computed: 'computeTextColor(color)'
        },
        outline: {
          type: Boolean
        },
        url: {
          type: String,
          notify: true,
        }
      },
      observers: [
        'colorContent(color)',
        'imageBg(url)',
      ],

      imageBg: function(url, node) {
        // console.log('imageBg', url);
        if (url) {
          this.customStyle['--theme-image'] = "url(" + url + ")";
          // console.log(this.customStyle['--theme-image']);
          this.updateStyles();
        }

        // if (node) {
        //   this.style.backgroundImage = "url('" + this.url + "')";
        //   this.style.backgroundSize = "cover";
        //   this.style.backgroundRepeat = "no-repeat";
        // }

        // this.style.backgroundImage = "url('" + url + "')";
        // this.style.backgroundSize = "cover";
        // this.style.backgroundRepeat = "no-repeat";
      },
      computeTextColor: function(color) {
        if (this.color) {
          var lightness = one.color(this.color).lightness();
          // return (lightness > 0.5) ? 'rgba(0,0,0,0.6)' : 'rgba(255,255,255,0.8)';
        } else {
          return null;
        }
      },
      _color: function(node, color, bgColor, colorOnly) {
        // node.style.color = color;
        // node.style.backgroundColor = bgColor;


        // if (colorOnly) {
        //   node.style.color = color;
        //   console.log(node);
        //   return;
        // }

        this.customStyle['--theme-color'] = color;
        this.customStyle['--theme-background-color'] = bgColor;
        this.updateStyles();
        if (this.outline) this._outline(node, bgColor);




      },
      _colorImage: function(node) {
        // console.log(node.hasAttribute('themed-image'));
        // console.log(node);
        // node.style.backgroundImage = "url('" + this.url + "')";
        // if (this.customStyle['--theme-image']) {
        //   node.style.backgroundImage = this.customStyle['--theme-image'];
        //   // console.log(node.style.backgroundImage);
        // }
      },
      _colorBorder: function(node, borderColor) {
        // node.style.borderColor = borderColor;
        this.customStyle['--theme-border'] = borderColor;
        this.updateStyles();
      },
      _outline: function(node, bgColor) {
        if (one.color(bgColor).lightness() > 0.9) {
          // node.style.outline = '1px solid rgba(0,0,0,.25)';
          // node.style.outlineOffset = '-1px';
          this.customStyle['--theme-outline-offset'] = '1px solid rgba(0,0,0,.25)';
          this.customStyle['--theme-outline-offset'] = '-1px';
          this.updateStyles();
        }
      },
      colorContent: function() {
        // this.style.height = "100%";
        // if (this.hasAttribute('themed')) this._color(this, this.textColor, this.Color);
        // if (this.hasAttribute('themed-reverse')) this._color(this, this.Color, this.textColor);
        // if (this.hasAttribute('themed-border')) this._colorBorder(this, this.color);
        // if (this.hasAttribute('themed-border-reverse')) this._colorBorder(this, this.textColor);
        // if (this.hasAttribute('themed-image')) this._imageBG(null, this);

        var nodes = Polymer.dom(this).querySelectorAll('[themed],[themed-reverse],[themed-border],[themed-border-reverse],[themed-color]');
        // console.log(nodes);
        for (var i = 0; i < nodes.length; i++) {
          if (nodes[i].hasAttribute('themed')) {
            this._color(nodes[i], this.color, this.textColor);
          } else if (nodes[i].hasAttribute('themed-reverse')) {
            this._color(nodes[i], this.textColor, this.color);
          } else if (nodes[i].hasAttribute('themed-border')) {
            this._colorBorder(nodes[i], this.color);
          } else if (nodes[i].hasAttribute('themed-border-reverse')) {
            this._colorBorder(nodes[i], this.textColor);
          } else if (nodes[i].hasAttribute('themed-color')) {
            this._color(nodes[i], this.textColor, this.color, true);
            // console.log('themed-image', nodes[i]);
            // this._colorImage(nodes[i]);
          }
        }
      }
    });
  </script>

</dom-module>

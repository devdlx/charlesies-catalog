<dom-module id="page-account">
  <template>

    <style media="screen" is="custom-style">
      :host {
        display: block;
      }

      paper-material {
        padding-top: 8px;
        padding-bottom: 16px;
        background-color: white;
        overflow: hidden;
      }

      paper-toolbar {
        --paper-toolbar-background: white;
      }

      .user {
        padding-top: 26px;
      }

      .body {
        padding: 16px;
      }

      .profile .userIcon {
        border-radius: 50%;
        width: 100px;
        height: 100px;
      }

      .info {
        margin: 8px;
        /*padding: 16px 16px 32px 16px;*/
        padding-left: 8px;
        text-align: center;
      }

      .headerIcon {
        position: absolute;
        width: 86px;
        height: 85px;
        right: -38px;
        bottom: -16px;
        color: rgba(0, 0, 0, 0.05);
        transform: rotateY( 180deg);
      }

      .cc_type {
        height: 100%;
        width: 70px;
      }

      .cc_end {
        height: 100%;
        font-size: 26px;
        line-height: 42px;
      }

      .margin-right-16 {
        margin-right: 16px;
      }

      .address {
        /*background-image: url('http://maps.google.com/maps/api/staticmap?center=5353+Cleveland+Ave+Columbus+Ohio+43231&zoom=15&amp&size=300x100');*/
        background-repeat: no-repeat;
        background-size: cover;
      }

      .line1 {
        font-size: 18px;
      }

      .card {
        padding-bottom: 16px
      }
    </style>

    <catalog-user id="catalogUser" loggedin="{{loggedin}}" wait="{{wait}}" user="{{user}}" defaultCard="{{defaultCard}}" defaultAddress="{{defaultAddress}}"></catalog-user>

    <paper-material class="profile layout vertical">

      <div class="user layout vertical center-center">

        <iron-image class="userIcon" src="[[user.profileImageURL]]" alt="user image" fade sizing="cover">
        </iron-image>

        <div class="info">
          <h3>[[user.displayName]]</h3>
          <span>[[user.displayName]]</span>
        </div>
      </div>

    </paper-material>

    <paper-material class="address layout vertical">

      <iron-icon class="headerIcon" icon="maps:local-shipping"></iron-icon>

      <paper-toolbar>
        <div>
          Address
        </div>
        <span class="flex"></span>
        <paper-icon-button icon="editor:mode-edit" on-tap="_navAddressList"></paper-icon-button>
      </paper-toolbar>

      <paper-item>
        <paper-item-body two-line>
          <div class="line1">
            <span>[[defaultAddress.add_street]]</span>
          </div>
          <div secondary>
            <span>[[defaultAddress.add_city]]</span>,
            <span>[[defaultAddress.add_state]]</span>,
            <span>[[defaultAddress.add_zip]]</span>
          </div>
        </paper-item-body>
      </paper-item>

    </paper-material>

    <paper-material class="card layout vertical">
      <iron-icon class="headerIcon" icon="icons:credit-card"></iron-icon>
      <paper-toolbar>
        <div>
          Cards
        </div>
        <span class="flex"></span>
        <paper-icon-button icon="editor:mode-edit" on-tap="_navCardList"></paper-icon-button>

      </paper-toolbar>

      <paper-item>
        <paper-item-body>
          <div class="layout horizontal">
            <iron-icon class="cc_type margin-right-16" src$="[[_computeTypeIcon(defaultCard.cc_type)]]"></iron-icon>
            <div class="cc_end">{{defaultCard.cc_end}}</div>
          </div>
        </paper-item-body>
      </paper-item>

      </div>
    </paper-material>


  </template>

  <script>
    (function() {
      Polymer({
        is: 'page-account',
        enableCustomStyleProperties: true,
        properties: {
          email: {
            type: String,
            notify: true,
            value: ""
          },
          password: {
            type: String,
            notify: true,
            value: ""
          },
          wait: {
            type: Boolean,
            notify: true,
          },
          loggedin: {
            type: Boolean,
            notify: true
          },
          user: {
            type: Object,
            notify: true,
          },
          provider: {
            type: String,
            value: 'password'
          },

          defaultAddress: {
            type: Object,
            notify: true,
          },

          defaultCard: {
            type: Object,
            notify: true,
          },

        },

        observers: [
          '_checkLoggedin(loggedin, wait, user)',
          // 'newCardValue(card.*)',
          // 'newAddressValue(address.*)'
          '_defaultAddress(defaultAddress)',
          '_defaultAddress(defaultCard)',
        ],

        _defaultAddress: function(defaultAddress) {
          console.log(defaultAddress);
        },

        _checkLoggedin: function(loggedin, wait, user) {
          // console.log(loggedin, wait, user);

          if (!loggedin && !wait) {
            console.log('not logged in!');
            this.fire('toast', {
              text: 'Have to be logged in to view page'
            });
            this.debounce('nav_delay', function (argument) {
              this.router.go('/login');
            }, 0);


            return;

          }

          if (!user) {
            this.debounce('nav_delay', function (argument) {
              this.router.go('/login');
            }, 0);
          }

        },

        _computeTypeIcon: function(type) {
          return 'bower_components/gold-cc-input/images/' + type + '.png';
        },

        newCardValue: function(card) {
          // console.log(cardRef.val());
          // console.log(card);
          if (card.length === 0) {
            this.noCard = true;
            return;
          }
          for (var i = 0; i < this.card.length; i++) {
            // console.log(this.card[i].default_card);
            if (this.card[i].default_card) {
              this.defaultCard = this.card[i];
              // console.log(this.defaultCard.cc_name);
              return;
            }
          }
        },

        newAddressValue: function(address) {
          // console.log(cardRef.val());
          // console.log(this.card);
          if (address.length === 0) {
            this.noAddress = true;
            return;
          }
          for (var i = 0; i < this.address.length; i++) {
            // console.log(this.card[i].default_card);
            if (this.address[i].default_address) {
              this.defaultAddress = this.address[i];
              // console.log(this.defaultAddress.add_street);
              return;
            }
          }
        },

        _navCardList: function() {
          this.fire('nav', {path:"/account/card"});
        },

        _navAddressList: function() {
          // this.showAddressList = !this.showAddressList;
          this.fire('nav', {path:"/account/address"});
        }


      });
    })();
  </script>

</dom-module>

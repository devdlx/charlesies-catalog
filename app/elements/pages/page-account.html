<dom-module id="page-account">
  <template>

    <style media="screen" is="custom-style">
      :host {
        display: block;
      }

      paper-material {
        max-width: 320px;
        margin: 0 auto;
        background-color: white;
        overflow: hidden;
      }

      paper-material[wide] {
        max-width: initial;
        margin: 16px;
        padding: 0;
      }

      paper-toolbar {
        --paper-toolbar-background: white;
      }

      .user {
        padding-top: 26px;
      }

      .body {
        padding: 16px;
      }

      .section {
        margin-bottom: 16px;
      }

      .userIcon {
        border-radius: 50%;
        width: 100px;
        height: 100px;
      }

      .info {
        margin: 8px;
        /*padding: 16px 16px 32px 16px;*/
        padding-left: 8px;
        text-align: center;
      }

      .info .header {
        margin: 0;
      }

      .info .subheader {
        margin: 0;
        color: #9E9E9E;
      }

      .headerIcon {
        position: absolute;
        width: 86px;
        height: 85px;
        right: -38px;
        bottom: -16px;
        color: rgba(0, 0, 0, 0.05);
        transform: rotateY( 180deg);
      }

      .cc_type {
        height: 100%;
        width: 70px;
      }

      .cc_end {
        height: 100%;
        font-size: 26px;
        line-height: 42px;
      }

      .margin-right-16 {
        margin-right: 16px;
      }

      .split {
        @apply(--layout-vertical)
      }

      [wide] .split {
        @apply(--layout-horizontal)
      }

      .card,
      .address {
        padding: 16px;
      }

      .card .header,
      .address .header {
        padding-bottom: 16px;
      }

      [wide] .divider {
        width: 1px;
        -webkit-box-shadow: -1px 0px 1px 0px rgba(0, 0, 0, 0.17);
        -moz-box-shadow: -1px 0px 1px 0px rgba(0, 0, 0, 0.17);
        box-shadow: -1px 0px 1px 0px rgba(0, 0, 0, 0.17);
      }

      paper-item {
        min-height: 72px;
      }

      .edit-action {
        margin-left: 16px;
      }

      .line1 {
        font-size: 18px;
      }
    </style>

    <catalog-user id="catalogUser" loggedin="{{loggedin}}" wait="{{wait}}" user="{{user}}"></catalog-user>
    <iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query>


    <paper-material wide$="{{wide}}">


      <div class="section user layout vertical center-center">
        <iron-image class="userIcon" src="[[user.profileImageURL]]" alt="user image" fade sizing="cover">
        </iron-image>

        <div class="info">
          <h3 class="header">[[user.displayName]]</h3>
          <div class="subheader">
            <span>[[user.provider]]</span>
          </div>
        </div>
      </div>


      <div class="split section layout">

        <div class="address layout vertical flex">

          <div class="header layout vertical center-center">
            Address
          </div>

          <template is="dom-if" if="{{!user.address}}" restamp="true">
            <div class="body layout vertical center-center">
              <paper-icon-button class="edit-action" icon="add" on-tap="_navAddressList"></paper-icon-button>
            </div>
          </template>


          <template is="dom-if" if="{{user.address}}" restamp="true">
            <paper-item>
              <paper-item-body two-line>
                <div class="line1">
                  <span>[[user.address.add_street]]</span>
                </div>
                <div secondary>
                  <span>[[user.address.add_city]]</span>,
                  <span>[[user.address.add_state]]</span>,
                  <span>[[user.address.add_zip]]</span>
                </div>
              </paper-item-body>
              <paper-icon-button class="edit-action" icon="editor:mode-edit" on-tap="_navAddressList"></paper-icon-button>
            </paper-item>
          </template>

        </div>

        <div class="divider"></div>

        <div class="card layout vertical flex">
          <!-- <iron-icon class="headerIcon" icon="icons:credit-card"></iron-icon> -->
          <div class="header layout vertical center-center">
            Card
          </div>


          <template is="dom-if" if="{{!user.card}}" restamp="true">
            <div class="body layout vertical center-center">
              <paper-icon-button class="edit-action" icon="add" on-tap="_navCardList"></paper-icon-button>
            </div>
          </template>


          <template is="dom-if" if="{{user.card}}" restamp="true">
            <paper-item>
              <paper-item-body>
                <div class="layout horizontal">
                  <iron-icon class="cc_type margin-right-16" src$="[[_computeTypeIcon(user.card.cc_type)]]"></iron-icon>
                  <div class="cc_end">{{user.card.cc_end}}</div>
                </div>
              </paper-item-body>
              <paper-icon-button class="edit-action" icon="editor:mode-edit" on-tap="_navAddressList"></paper-icon-button>
            </paper-item>
          </template>

        </div>

      </div>

    </paper-material>


  </template>

  <script>
    (function() {
      Polymer({
        is: 'page-account',
        enableCustomStyleProperties: true,
        properties: {
          wait: {
            type: Boolean,
            notify: true,
          },
          loggedin: {
            type: Boolean,
            notify: true
          },
          user: {
            type: Object,
            notify: true,
          },
          Address: {
            type: Object,
            notify: true,
          },
          Card: {
            type: Object,
            notify: true,
          },

        },

        observers: [
          // '_checkAuth(wait, user)',
          // 'newCardValue(card.*)',
          // 'newAddressValue(address.*)'
          '_check(Address)',
          '_check(user)',
        ],

        _check: function(check) {
          // console.info('check: ', check);
        },

        _computeAccountText: function(loggedin) {
          if (loggedin) {
            return this.user.displayName;
          }
          return 'Account';
        },

        _checkAuth: function(wait, user) {
          // console.log(loggedin, wait, user);

          if (!user && !wait) {
            console.log('not logged in!');
            this.fire('toast', {
              text: 'Have to be logged in to view page'
            });
            this.debounce('nav_delay', function(argument) {
              this.router.go('/login');
            }, 0);

            return;
          }

          if (!user) {
            this.debounce('nav_delay', function(argument) {
              this.router.go('/login');
            }, 0);
          }

        },

        _computeTypeIcon: function(type) {
          return 'bower_components/gold-cc-input/images/' + type + '.png';
        },

        newCardValue: function(card) {
          // console.log(cardRef.val());
          // console.log(card);
          if (card.length === 0) {
            this.noCard = true;
            return;
          }
          for (var i = 0; i < this.card.length; i++) {
            // console.log(this.card[i].default_card);
            if (this.card[i].default_card) {
              this.user.card = this.card[i];
              // console.log(this.defaultCard.cc_name);
              return;
            }
          }
        },

        newAddressValue: function(address) {
          // console.log(cardRef.val());
          // console.log(this.card);
          if (address.length === 0) {
            this.noAddress = true;
            return;
          }

          for (var i = 0; i < this.address.length; i++) {
            // console.log(this.card[i].default_card);
            if (this.address[i].default_address) {
              this.defaultAddress = this.address[i];
              // console.log(this.defaultAddress.add_street);
              return;
            }
          }
        },

        _navCardList: function() {
          // this.fire('nav', {
          //   path: "/account/card"
          // });
          this.fire('open-card-dialog');
        },

        _navAddressList: function() {
          // this.showAddressList = !this.showAddressList;
          // this.fire('nav', {
          //   path: "/account/address"
          // });
          this.fire('open-address-dialog');
        }


      });
    })();
  </script>

</dom-module>

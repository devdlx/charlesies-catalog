<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-collection.html">

<link rel="import" href="../catalog-data/catalog-data.html">
<link rel="import" href="../package-tile/package-tile.html">
<link rel="import" href="../guide-card/guide-card.html">
<link rel="import" href="../cart-icon/cart-icon.html">

<dom-module id="page-packages">
  <link rel="import" type="css" href="page-packages.css">
  <template>
    <catalog-data id="cdata" app="charlesiesbeta" blog="{{blog}}" blogid="8038113399974572777"></catalog-data>
    <firebase-collection id="packages" location="https://charlesiesbeta.firebaseio.com/packages" data="{{packages}}"></firebase-collection>
    <paper-header-panel mode="seamed" class="fit">

      <paper-toolbar class="paper-header">
        <app-logo full class="flex"></app-logo>
        <paper-fab mini icon="add" on-click="newItemClick"></paper-fab>
        <app-bar class="horizontal layout center end-justified" query="{{q}}"></app-bar>
        <cart-icon></cart-icon>
      </paper-toolbar>

      <div class="content fit">

        <div class="packages layout horizontal wrap">
          <template is="dom-repeat" items="{{packages}}">
            <a href$="[[_packageLink(item.__firebaseKey__)]]" is="app-link" class="package flex-none">
              <package-tile package="[[item]]" name$="[[item.name]]"></package-tile>
            </a>
            <!-- <div class="package flex-none">
              <package-tile package="{{item}}"></package-tile>
            </div> -->
          </template>
        </div>

        <div id="guides-container">
          <h3>Post</h3>
          <div id="guide-list" class="horizontal layout wrap">
            <template is="dom-repeat" items="[[blog.items]]">
              <a href$="[[_link('posts',item.id)]]" is="app-link">
                <guide-card post="[[item]]"></guide-card>
              </a>
            </template>
            <div id="coming-soon">More guides coming soon, stay tuned!</div>
          </div>
        </div>

      </div>



    </paper-header-panel>


  </template>
</dom-module>

<script>
  Polymer({
    is: 'page-packages',
    enableCustomStyleProperties: true,
    properties: {
      q: {
        type: String,
        notify: true
      }
    },

    newItemClick: function(e, f) {
      // console.log('newItemClick', e, f);
      // this.$.cdata.newPackage();
      var coll = this.$.packages;
      coll.add(this.$.cdata.newPackageObject);
    },
    attached: function() {
      // reset page title since this is the default page
      this.fire('page-meta', {
        title: null
      });
    },
    observers: [
      'search(q)'
    ],
    search: function(q) {
      if (q || this.q) {
        this.router.go('/browse?q=' + (q || this.q));
      }
    },
    _link: function() {
      return "/" + Array.prototype.slice.call(arguments).join("/");
    },
    _packageLink: function(id) {
      // return "/browse?packageId=" + name;
      return "/p/" + id;
    },
    guideSelect: function(e) {
      this.router.go('/guides/' + e.currentTarget.guide);
    }
  });
</script>

<dom-module id="page-home">
  <template>
    <style is="custom-style">
      .grid-layout {
        padding-top: 16px;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-direction: row;
        -webkit-flex-direction: row;
        flex-direction: row;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -ms-flex-wrap: wrap;
        -webkit-flex-wrap: wrap;
        flex-wrap: wrap;
      }

      .grid-cell {
        margin: 16px;
        width: calc(100vh*.5);
      }

      @media all and (min-width: 448px) {
        .grid-cell {
          width: 208px;
          /*margin: 0 8px;*/
        }
      }

      .addFab {
        position: fixed;
        bottom: 16px;
        right: 16px;
        color: #fff;
        will-change: transform;
        transition: -webkit-transform .2s ease-in-out;
        transition: transform .2s ease-in-out;
      }
    </style>

    <!-- <firebase-collection id="products" location="https://charlesiesbeta.firebaseio.com/products" data="{{products}}" order-by-child="priorty"></firebase-collection> -->
    <catalog-user id="catalogUser" user="{{user}}"></catalog-user>

    <div class="grid-layout">
      <template is="dom-repeat" items="{{products}}">
        <!-- <a href$="[[_packageLink(item.name)]]" is="pushstate-anchor" class="grid-cell"> -->
        <!-- <package-tile package="[[item]]" name$="[[item.name]]"></package-tile> -->
        <!-- </a> -->
        <product-card id="{{item.__firebaseKey__}}" class="grid-cell"></product-card>
      </template>
    </div>

    <template is="dom-if" if="{{user.isAdmin}}">
      <paper-fab class="addFab" icon="add" on-tap="_navNewProduct"></paper-fab>
    </template>

  </template>

  <script>
    Polymer({
      is: 'page-home',
      enableCustomStyleProperties: true,
      properties: {
        router: Object,
        user: {
          type: Object,
          notify: true
        }
      },

      observers: [
        // 'check(user)',
        '_auth(auth, user)',

      ],

      _auth: function(auth, user) {
        // console.log(auth);
        if (auth === 'instagram') {
          // console.log(window.location.hash.split('#access_token=')[1]);
          var done = this.$.catalogUser.authInstagram(window.location.hash.split('#access_token=')[1]);
          // console.log(done);
          if (done) {
            this.debounce('authInstagramFFFF', function(argument) {
              window.close();
            });
          }
        }

      },

      check: function(user) {
        console.log(user);
      },

      _navNewProduct: function(e, f) {
        this.fire('open-product', {
          new: true
        });
      },

      attached: function() {
        // reset page title since this is the default page
        // this.fire('page-meta', {
        //   title: null
        // });

      }
    });
  </script>
</dom-module>

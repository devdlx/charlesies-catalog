<dom-module id="page-home">
  <template>
    <style is="custom-style">
      :host {
        display: block;
        padding-bottom: 72px
      }

      .grid-container {
        padding: 16px;
      }

      .grid-layout {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
      }

      .grid-cell {
        margin-bottom: 16px;
        width: 100%;
        height: 320px;
      }

      @media all and (min-width: 481px) {
        .grid-container {
          @apply(--layout-vertical);
          @apply(--layout-center);
        }
        .grid-layout {
          width: 460px;
        }
        .grid-cell {
          margin: 8px;
          width: 214px;
          height: 214px;
        }
        .grid-cell[wide] {
          width: 444px;
          /*height: 444px;*/
        }
      }

      @media all and (min-width: 961px) and (orientation: landscape) {
        .grid-container {
          padding-left: 0;
          padding-right: 0;
        }
        .grid-layout {
          /*width: 690px;*/
        }
        .grid-cell[wide] {
          width: 444px;
        }
      }

      @media all and (min-width: 1281px) and (max-width: 1600px) {
        .grid-cell {
          margin: 8px;
          width: 214px;
        }
        .grid-layout {
          width: 920px;
        }
      }

      .addFab {
        position: fixed;
        bottom: 16px;
        right: 16px;
        color: #fff;
        will-change: transform;
        transition: -webkit-transform .2s ease-in-out;
        transition: transform .2s ease-in-out;
        z-index: 1;
      }

      category-card {
        /*background-color: red;*/
      }
    </style>

    <!-- <firebase-collection id="catalogCategories" location="https://charlesiesbeta.firebaseio.com/categories" data="{{_categories}}" order-by-childx="priorty"></firebase-collection> -->
    <catalog-user id="catalogUser" user="{{user}}"></catalog-user>

    <div class="body layout vertical center-center">
      <paper-spinner active="[[loading]]" hidden="{{!loading}}"></paper-spinner>

      <template is="dom-if" if="[[!categories.length]]">
        <div class="layout vertical center-center" style="margin-top: 64px;">
          <h3>Nothing at this time</h3>
          <!-- <paper-button class="color" style="background-color:white; color: red;" raised on-tap="_navAddProduct">Create Product <iron-icon icon="add"></iron-icon></paper-icon-button> -->
        </div>
      </template>

      <template is="dom-if" if="{{user.isAdmin}}">
        <paper-fab class="addFab" icon="add" on-tap="_navNewCategory"></paper-fab>
      </template>

    </div>


    <div id="grid" class="grid-container">

      <div class="grid-layout">
        <template is="dom-repeat" items="{{categories}}">
          <category-card key="[[item.__firebaseKey__]]" category="[[item]]" class="grid-cell" admin="[[user.isAdmin]]" wide$="{{item.wide}}"></category-card>
        </template>
      </div>

    </div>

  </template>

  <script>
    Polymer({
      is: 'page-home',
      enableCustomStyleProperties: true,
      properties: {
        router: Object,
        user: {
          type: Object,
          notify: true
        },
        loading: {
          type: Boolean,
          notify: true,
          value: true
        },
        // Categories

        categories: {
          type: Array,
          notify: true,
          value: []
        }
      },

      observers: [
        // 'check(user)',
        '_auth(auth, user)',
        // 'check(categories)'
      ],


      attached: function() {
        var categoriesArray;
        var categories = new Fireproof(new Firebase('https://charlesiesbeta.firebaseio.com/categories'));
        // categories.orderByChild('showInNav').equalTo(true).on('child_added', function(snap) {
        categories.on('child_added', function(snap) {
          // console.log(snap.val());
          var val = snap.val();
          val.__firebaseKey__ = snap.key();
          this.push('categories', val);
        }.bind(this)).then(function(argument) {
          this.loading = false;
          // console.log(this.categories);
        }.bind(this));

      },



      _auth: function(auth, user) {
        // console.log(auth);
        if (auth === 'instagram') {
          // console.log(window.location.hash.split('#access_token=')[1]);
          var done = this.$.catalogUser.authInstagram(window.location.hash.split('#access_token=')[1]);
          // console.log(done);
          if (done) {
            this.debounce('authInstagramFFFF', function(argument) {
              window.close();
            });
          }
        }

      },

      check: function(user) {
        console.log(user);
      },

      _navNewCategory: function(e, f) {
        this.fire('new-category');
      },


    });
  </script>
</dom-module>

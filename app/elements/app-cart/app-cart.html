<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">


<link rel="import" href="../cart-item/cart-item.html">
<link rel="import" href="../catalog-cart/catalog-cart.html">

<dom-module id="app-cart">
  <style>
    :host {
      background: white;
      @apply(--layout-fit);
      @apply(--layout);
      @apply(--layout-vertical);
    }

    #toolbar {
      color: #666;
    }

    #toolbar-title {
      margin-left: 15px;
    }

    #download {
      padding: 16px;
    }

    #dl code {
      font-weight: bold;
      color: #3f51b5;
    }

    #download h4 {
      font-size: 14px;
      font-weight: bold;
      margin: 0;
    }

    #download > section {
      margin-bottom: 24px;
    }

    #download textarea {
      box-sizing: border-box;
      display: block;
      width: 100%;
      height: 110px;
      padding: 8px;
      background: var(--paper-blue-grey-50);
      border: 1px solid var(--paper-blue-grey-100);
      border-radius: 2px;
      font-size: 12px;
      color: var(--paper-blue-grey-500);
      resize: none;
    }

    #download paper-button {
      background: #e91e63;
      color: white;
      margin-top: 10px;
    }

    paper-tabs {
      --paper-tabs-selection-bar-color: #304ffe;
    }

    paper-tab {
      --paper-tab-ink: #304ffe;
    }

    .avatar {
      display: inline-block;
      box-sizing: border-box;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--paper-amber-500);
    }

    .blue {
      background-color: var(--paper-light-blue-300);
    }
  </style>
  <template>
    <catalog-cart id="data" items="{{items}}"></catalog-cart>

    <paper-toolbar id="toolbar">
      <iron-icon icon="stars"></iron-icon>
      <span id="toolbar-title" class="flex">My Shopping Cart</span>
      <iron-icon icon="chevron-right" on-tap="close"></iron-icon>
    </paper-toolbar>
    <paper-tabs id="tabs" selected="{{_tab}}">
      <paper-tab name="products">Items (<span>[[items.length]]</span>)</paper-tab>
      <paper-tab name="download">Checkout</paper-tab>
    </paper-tabs>

    <iron-pages selected="[[_tab]]" class="flex">

      <!-- BEGIN Products Page -->
      <div id="products">
        <paper-listbox>
          <template is="dom-repeat" items="[[items]]">
            <cart-item item="[[item]]" on-remove="_handleRemove"></cart-item>
          </template>
        </paper-listbox>
      </div>
      <!-- END Products Page -->



      <!-- BEGIN Checkout Page -->
      <div id="download">
        <section>
          <h4>Checkout</h4>

          <paper-radio-group selected="{{downloadMethod}}" id="dl">
            <paper-radio-button name="products">
              <code>products folder</code> - the full source for the latest version of all your selected products
            </paper-radio-button>
            <paper-radio-button name="bower">
              <code>bower.json</code> - just the bower.json file, from which you can run bower install to fetch your products
            </paper-radio-button>
          </paper-radio-group>

          <paper-button raised on-tap="download">Download</paper-button>
        </section>
        <section>
          <h4>Bower Command</h4>

          <p>You can copy the command below and paste it into the terminal to install the products from your cart into a project that already uses Bower.
          </p>

        </section>
      </div>

      <!-- END Checkout Page -->



    </iron-pages>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'app-cart',
    enableCustomStyleProperties: true,
    properties: {
      items: {
        type: Array,
        notify: true
      },
      downloadMethod: {
        type: String,
        value: 'bower'
      },
      _tab: {
        type: Number,
        value: 0
      }
    },
    log: function() {
      console.log(arguments);
    },
    close: function() {
      this.fire('cart-close');
    },
    add: function(item) {
      if (this.includes(item)) {
        this.fire('toast', {
          text: _name + " is already in your cart"
        });
      } else if (this.$.data.add(item)) {
        this.fire('toast', {
          text: item.name + " has been added to your cart"
        });
      }
    },
    remove: function(item) {
      this.$.data.remove(item);
      this.fire('toast', {
        text: item.name + " has been removed from your cart"
      });
    },
    _hasAny: function(arr) {
      return arr && (arr > 0);
    },
    _handleRemove: function(e) {
      this.remove(e.currentTarget.item);
    },
    includes: function(el) {
      return this.$.data.includes(el);
    },
    _processPayment: function() {
      ga('send', 'event', 'checkout');
    }
  });
</script>

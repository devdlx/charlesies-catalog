<dom-module id="category-card">
  <style>
    paper-material {
      display: block;
      height: 100%;
      width: 100%;
      position: relative;
      transition: var(--material-curve-320);
      transform: translate(-100px, 0px);
      opacity: 0;
    }

    :host(.active) paper-material {
      transform: translate(0, 0);
      opacity: 1;
    }

    .titleContainer {
      position: absolute;
      bottom: 0;
      right: 0;
      background-color: rgba(0, 0, 0, 0.54);
      left: 0;
      padding-left: 16px;
    }

    .title {
      transition: all 400ms 320ms;
      transition-timing-function: var(--material-curve-320);
      transform: translate(-50px, 0);
      opacity: 0;
      height: 28px;
      color: white;
    }

    :host(.active) .title {
      transform: translate(0, 0);
      opacity: 1;
    }

    .title[extended] {
      display: block;
    }

    :host(.active) .editButton {
      transform: translate(0, 0);
      opacity: 1;
    }

    .editButton {
      position: absolute;
      top: 16px;
      right: 16px;
      font-size: 13px;
      transition: all 400ms 320ms;
      transition-timing-function: var(--material-curve-320);
      transform: translate(50px, 0);
      opacity: 0;
      z-index: 1;
    }

    paper-material {
      box-sizing: border-box;
      height: 100%;
      width: 100%;
      padding: 16px;
      background: white;
    }

    .categoryImage {
      background-color: red;
    }
  </style>
  <template>
    <!-- <catalog-package id="package" key="{{key}}"></catalog-package> -->

    <!-- <theme-color draggable="true" id="content" color="red" url="[[package.image]]"> -->
    <paper-material elevation="0" animated="true" themed themed-image on-tap="_navCategory">
      <!-- <a href$="products?category={{category.name}}"> -->
        <paper-spinner active="[[loading]]" hidden="{{!loading}}"></paper-spinner>

        <iron-image fade class="categoryImage fit" src="[[_computeCategoryImage(category)]]" sizing="cover" position="top" preload placeholder="data:image/gif;base64,R0lGODdhyADIAOMAAO7u/5aWlqGho9jY5OPj8cLCyqyssLe3vc3N1wAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAyADIAAAE/hDISau9OOvNu/9gKI5kaZ5oqq5s675wLM90bd94ru987//AoHBILBqPyKRyyWw6n9CodEqtWq/YrHbL7Xq/4LB4TC6bz+i0es1uu9/wuHxOr9vv+Lx+z+/7/4CBgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS06kB1tYqA9cUBQEFrgLWAgIqBOEBFNuu1gMs2ugT3d/rAe0r77bsFwMGAQLzEggc8AcQAIJwA+EBuKbQmgF+3iocDHBAXiZ9Fd6dAxhuo4R3/gwnGDgnkqE1BBM0XrN3CSOFgQYM+ouHEsFMAP1i2lQIAN8EhwS6kZPQ74BMnpZcTgiHkoA1AhKxAWDaU+pHqwvrVVVI1ScmpRIwYjxwTqo+r1vTafV6FmtSrRXEak0ooB+8tjzR4v251m0llwSgUnUaAOrJtFMDoESrty9XxYi/wk0sMEBMoRKo7iRK8SiFxu285vQMoIDR0qdNN+rmbxxJlRFLi7u22OG1mDjP4bYb2uFVf+r0CZ+cyOS1oRD/cUM4cN5EA3bDhszqWOHEhBLIZh+qHdnmaFABwIwm9BxLZxAtn6fGvr379/Djy59Pv779+/jz69/Pv7///wAGQyjggAQWaOCBCCao4IIMNujggxBGKOGEFFZo4YUYZqjhhhx26OGHIIYo4ogklmjiiSimqOKKLLbo4oswxijjjDRKEQEAOw=="></iron-image>

        <div class="titleContainer">
          <div class="title paper-font-title" extended$="_extendedTitle(category)">[[category.label]]</div>
        </div>

        <template is="dom-if" if="[[admin]]">
          <paper-icon-button class="editButton" icon="editor:mode-edit" on-tap="_onDeleteClick"></paper-icon-button>
        </template>

      <!-- </a> -->
    </paper-material>
    <!-- </theme-color> -->

  </template>

  <script>
    Polymer({
      is: 'category-card',
      enableCustomStyleProperties: true,
      properties: {
        key: {
          type: String,
          notify: true
        },
        category: {
          type: Object
        },
        admin: {
          type: Boolean,
          notify: true
        },
        loading: {
          type: Boolean,
          notify: true,
          value: true
        },
      },
      attached: function() {
        var tiles = this.parentNode.parentNode.querySelectorAll('category-card');
        var index = Array.prototype.indexOf.call(tiles, this);
        // console.log(Array.prototype.indexOf.call(tiles, this));
        setTimeout(function() {
          this.classList.add('active');
        }.bind(this), (index + 1) * 90);
      },
      _extendedTitle: function() {
        // console.log('_extendedTitle', p.title.length > 20);
        if (!this.category.label) return;
        if (this.category.label.length > 20) return true;
      },
      _onDeleteClick: function(e) {
        console.log(this.category);
        // this.$.package.remove(this.package);
      },
      _navCategory: function(_, e) {
        // console.log(e);
        this.fire('open-category', this.name);
      },
      _computeCategoryImage: function() {
        // var products = new Fireproof(new Firebase('https://charlesiescom.firebaseio.com/products'));
        // // console.log('categories/' + this.category.name);
        // var child = '/categories/' + this.category.__firebaseKey__;
        // products.orderByChild(child).equalTo(true).limitToFirst(1).then(function(snap) {
        //   var val = snap.val();
        //   if (val) {
        //     // console.log(val);
        //   }
        // }.bind(this)).then(function(argument) {
        //   // console.log(this);
        //   this.loading = false;
        // }.bind(this));
        // dont like!!! FFFF


        // var image = new Fireproof(new Firebase('https://charlesiescom.firebaseio.com/images'));
        // // console.log('categories/' + this.category.name);
        // var child = '/categories/' + this.category.__firebaseKey__;
        // image.orderByChild(child).equalTo(true).limitToFirst(1).then(function(snap) {
        //   var val = snap.val();
        //   if (val) {
        //     // console.log(val);
        //   }
        // }.bind(this)).then(function(argument) {
        //
        //   this.loading = false;
        // }.bind(this));

        if (this.category.name === 'tops') {
          return 'https://scontent-iad3-1.cdninstagram.com/hphotos-xpf1/t51.2885-15/s750x750/sh0.08/e35/12331563_897093783744114_1700989463_n.jpg';
        }

        if (this.category.name === 'winter-time') {
          return 'https://scontent-iad3-1.cdninstagram.com/hphotos-xap1/t51.2885-15/s750x750/sh0.08/e35/12331455_156334034724911_639055508_n.jpg';
        }

      }
    });
  </script>
</dom-module>

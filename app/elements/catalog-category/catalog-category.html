<link rel="import" href="../catalog-data/catalog-data.html">

<dom-module id="catalog-category">
  <template>
    <!-- <catalog-data package-map="{{_packages}}"></catalog-data> -->
    <firebase-document location$="{{_computeCategoryLocation(key)}}" data="{{edit}}" on-firebase-value="_computeData"></firebase-document>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'catalog-category',
    properties: {
      key: {
        type: String,
        notify: true,
        // computed: '_computeCategoryByShort(short)'
      },
      short: {
        type: String,
        notify: true
      },
      edit: {
        type: Object,
        notify: true,
        // value: {'white': 'squares'}
      },

      data: {
        type: Object,
        notify: true,
        // computed: 'getData(_data)'
      }
    },
    observers: [
      '_computeCategoryByShort(short)'

    ],
    _computeCategoryLocation: function(key) {
      // console.log(key);
      return 'https://charlesiescom.firebaseio.com/categories/' + key;
    },
    _computeCategoryByShort: function(short) {
      // console.log(short);
      if (short) {
        var catloc = new Fireproof(new Firebase('https://charlesiescom.firebaseio.com/categories/'));
        catloc.orderByChild('short').equalTo(short).then(function(snap) {
          // console.log(snap.val());
          // console.log(Object.keys(snap.val())[0]);
          this.set('key', Object.keys(snap.val())[0]);
          // this.set('data', snap.val()[Object.keys(snap.val())[0]]);
          // return Object.keys(snap.val())[0];
        }.bind(this));

      }

    },
    _computeData: function(e, snap) {
      // console.log(this._data);
      var _value =this.edit;
      _value.key = snap.key();
      this.set('data', this.edit);
    },

    getData: function(_data) {
      console.log(_data);
      return _data;
    }
  });
</script>

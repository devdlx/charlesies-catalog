<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-document.html">
<link rel="import" href="../../bower_components/google-apis/google-client-loader.html">

<dom-module id="catalog-data">
  <template>
    <iron-ajax id="req" url="/blogger.json" method="get" handle-as="json" on-response="_handleResponse"></iron-ajax>

    <google-client-loader id="gcl" name="blogger" version="v3"></google-client-loader>

    <firebase-document location="{{_locFBD}}" data="{{fbd}}"></firebase-document>
    <firebase-collection location="{{_locFBC}}" data="{{fbc}}"></firebase-collection>


  </template>
</dom-module>

<script>
  (function() {
    var _data = {};

    Polymer({

      is: 'catalog-data',

      properties: {

        data: {
          type: Object,
          readOnly: true,
          notify: true,
        },

        /* FBCollections */
        _locFBC: {
          type: String,
        },
        collection: String,
        fbc: {
          type: Array,
          notify: true
        },


        /* FBDocument */
        _locFBD: {
          type: String,

        },
        fbd: {
          type: Object,
          notify: true
        },
        document: String,

        /* Blogger */
        blogid: {
          type: String,
          notify: true
        },
        posts: {
          type: Object,
          notify: true
        },
        postid: {
          type: String,
          notify: true
        }
      },

      listeners: {
        // 'google-api-load': '_gcl'
      },
      observers: [
        /* Blogger */
        '_getPostList(blogid)',
        '_getPostSingle(posts, postid)',
        /* Firebase */
        '_genFBDocumentLoc(app, document)',
        '_genFBCollectionLoc(app, collection)'

      ],

      ready: function (argument) {
        console.log(this._data);
      },
      /*  Firebase  */
      _genLoc: function(app, ext) {
        // console.log('_genLoc', app, ext);
        return 'https://' + app + '.firebaseio.com/' + ext

      },

      _genFBDocumentLoc: function(app, document) {
        //console.log('_genFBDocument', app, document);
        // return this._genLoc(app, document)
        this._locFBD = this._genLoc(app, document);
      },

      _genFBCollectionLoc: function(app, collection) {
        // console.log('_genFBCollection', app, collection);
        //return this._genLoc(app, collection)
        this._locFBC = this._genLoc(app, collection);
      },

      /*  Blogger  */
      _getPostList: function(blogid) {
        //console.log('_getPostList', blogid);
        if (blogid) {
          this.$.req.generateRequest();
          // var blogger = this.$.gcl;
          // blogger.addEventListener('google-api-load', function(event) {
          //   var request = blogger.api.post.list({
          //     blogId: this.blogid,
          //     key: 'AIzaSyAzyqzqu1sURmPH3VPzkOc9ywT7lCPPPF4'
          //   });
          //   request.execute(function(resp) {
          //     console.log(resp);
          //   });
          // });

        }
      },
      _getPostSingle: function(posts, postid) {
        // console.log('_getPostSingle', posts, postid);
        if (postid && this.posts) {
          for (var i = 0; i < posts.items.length; i++) {
            if (posts.items[i].id == postid) {
              // console.log(this.posts.items[i].id);
              // return posts.items[i];
              // console.log(this.posts.items[i]);
              // this.data = this.posts.items[i];
            };
          }

          //this.$.req.generateRequest();
          // var blogger = this.$.gcl;
          // blogger.addEventListener('google-api-load', function(event) {
          //   var request = blogger.api.posts.list({
          //     blogId: this.blogid,
          //     postId: this.postid,
          //     key: 'AIzaSyAzyqzqu1sURmPH3VPzkOc9ywT7lCPPPF4'
          //   });
          //   request.execute(function(resp) {
          //     console.log(resp);
          //   });
          // });

        }
      },
      _handleResponse: function(_, req) {
        //console.log(req.response.items);
        this.posts = req.response;
        this._data = {data: "yup"};
      },

    });
  })();
</script>

<dom-module id="catalog-data">
  <template>
    <iron-ajax id="checkoutReq" url="http://localhost:8080/checkout" method="post" handle-as="json" on-response="_handleCheckoutPostsResponse" on-error="_handleCheckoutPostsError"></iron-ajax>
  </template>
  <script>
    (function() {

      var _instances = [],
        _data={};

      var _add = function(type, item) {
        var check = _instances[0];
        var insertAt = 0;








      };

      var _remove = function(product_index) {
        var check = _instances[0];
        var removeAt = product_index;
        // for (var i = 0; i < check.items.length; i++) {
        //   if (check.items[i] === product || check.items[i].name === product.name) {
        //     removeAt = i;
        //   }
        // }

        if (removeAt >= 0) {
          _instances.forEach(function(instance) {
            instance.splice('items', removeAt, 1);
            instance.fire('item-removed', product_index, {
              bubbles: false
            });
          });
        } else {
          return false;
        }
      };


      var _updateAll = function() {
        _instances.forEach(function(instance) {
          // instance.data = _instances[0].data;
          instance.data = _data;
        });
      };

      Polymer({
        is: 'catalog-data',
        ready: function() {

          // SC.oEmbed("http://soundcloud.com/forss/flickermood", {
          //   auto_play: true
          // }, function(oembed) {
          //   console.log("oEmbed response: ", oembed);
          // });
        },
        attached: function() {
          if (_instances.length === 0 && !_data) {
            //this.$.req.generateRequest();
          }
          _instances.push(this);
        },
        detached: function() {
          _instances.splice(_instances.indexOf(this), 1);
        },
        properties: {

          data:{
            type: Object,
            notify: true,
          }

        },

        observers: [

        ],

        created: function() {
          _instances.push(this);
          // this.data = _data;
        },

        checkout: function(order) {
          this.$.checkoutReq.body = order;
          this.$.checkoutReq.method = 'POST';
          this.$.checkoutReq.generateRequest();

        },

        _handleCheckoutPostsResponse: function(_, req) {
          // console.log('_handleCheckoutPostsResponse: ', req.response);
          // _add('checkout', req.response);
          this.fire('checkout-response', req.response)
        },
        _handleCheckoutPostsError: function(_, req) {
          // console.log('_handleCheckoutPostsResponse: ', req.response);
          // _add('checkout', req.response);
          this.fire('checkout-response', req.response)
        },


      });
    })();
  </script>

</dom-module>

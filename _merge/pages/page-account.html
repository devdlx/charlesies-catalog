<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">

<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/iron-component-page/iron-component-page.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-badge/paper-badge.html">

<link rel="import" href="../../bower_components/paper-input/paper-input.html">

<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">

<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../catalog-data/catalog-data.html">
<link rel="import" href="../catalog-user/catalog-user.html">
<link rel="import" href="../cart-icon/cart-icon.html">
<link rel="import" href="../cart-item-icon/cart-item-icon.html">
<link rel="import" href="../app-logo/app-logo.html">
<link rel="import" href="../app-bar/app-bar.html">


<dom-module id="page-account">
  <template>

    <style media="screen" is="custom-style">
      :host {
        display: block;
      }

      paper-material {
        max-width: 320px;
        margin: 0 auto;
        background-color: white;
        overflow: hidden;
        padding: 16px;
      }

      paper-material[wide] {
        max-width: initial;
        margin: 16px;
      }

      paper-toolbar {
        --paper-toolbar-background: white;
      }

      .user {
        padding-top: 26px;
      }

      .body {
        padding: 16px;
      }

      .section {
        margin-bottom: 16px;
      }

      .userIcon {
        border-radius: 50%;
        width: 100px;
        height: 100px;
      }

      .info {
        margin: 8px;
        /*padding: 16px 16px 32px 16px;*/
        padding-left: 8px;
        text-align: center;
      }

      .info .header {
        margin: 0;
      }

      .info .subheader {
        margin: 0;
        color: #9E9E9E;
      }

      .headerIcon {
        position: absolute;
        width: 86px;
        height: 85px;
        right: -38px;
        bottom: -16px;
        color: rgba(0, 0, 0, 0.05);
        transform: rotateY( 180deg);
      }

      .cc_type {
        height: 100%;
        width: 70px;
      }

      .cc_end {
        height: 100%;
        font-size: 26px;
        line-height: 42px;
      }

      .margin-right-16 {
        margin-right: 16px;
      }

      .split {
        @apply(--layout-vertical)
      }

      [wide] .split {
        @apply(--layout-horizontal)
      }

      .card,
      .address {
        padding: 16px;
      }

      .card .header,
      .address .header {
        padding-bottom: 16px;
      }

      [wide] .divider {
        width: 1px;
        -webkit-box-shadow: -1px 0px 1px 0px rgba(0, 0, 0, 0.17);
        -moz-box-shadow: -1px 0px 1px 0px rgba(0, 0, 0, 0.17);
        box-shadow: -1px 0px 1px 0px rgba(0, 0, 0, 0.17);
      }

      paper-item {
        min-height: 72px;
      }

      .edit-action {
        margin-left: 16px;
      }

      .line1 {
        font-size: 18px;
      }

      .login-form {
        background-color: white;
        padding: 16px 16px 32px 16px;
      }

      .login-form[wide] {
        width: 300px;
        margin: 16px auto;
      }

      .form-submit {
        width: 100%;
      }

      paper-button {
        transition: background-color 0.5s ease;
      }
      /*paper-button[disabled] {
        background: #a8a8a8 !important;
        color: black;
      }*/

      .icon {
        width: 16px;
        height: 16px;
      }

      .addons paper-button.instagram {
        background: var(--paper-green-300);
        color: black;
      }

      .addons paper-button {
        padding: 8px;
        margin-right: 16px;
      }

      paper-button.facebook {
        background: #3B5998;
        color: white;
      }

      paper-button.google {
        background: #DC4A38;
        color: white;
      }

      paper-button.twitter {
        background: #55acee;
        color: white;
      }
    </style>

    <catalog-user id="catalogUser" loggedin="{{loggedin}}" wait="{{wait}}" user="{{user}}"></catalog-user>
    <iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query>

    <iron-pages selected="{{_page}}">

      <paper-material class="login-form layout vertical center-center" wide$="{{wide}}">

        <h2 class="form-title">Login</h2>
        <br>
        <div class="layout vertical">
          <form is="iron-form" id="loginform" method="post">
            <paper-input tabindex="0" no-label-float maxlength="25" required name="email" label="email" type="email" value="{{email}}" disabled$="{{wait}}"></paper-input>
            <paper-input no-label-float maxlength="25" required name="password" label="password" type="password" value="{{password}}" disabled$="{{wait}}"></paper-input>
            <br>
            <paper-button raised class="form-submit" on-tap="_loginPassword" disabled$="{{wait}}">login</paper-button>
          </form>
          <br>
          <br>
          <div class="">
            <paper-button disabled$="{{wait}}" class="facebook" on-tap="_loginFacebook">
              <iron-icon src="/images/facebook-24.png"></iron-icon>
            </paper-button>
            <paper-button disabled$="{{wait}}" class="google" on-tap="_loginGoogle">
              <iron-icon src="/images/google-plus-24.png"></iron-icon>
            </paper-button>
            <paper-button disabled$="{{wait}}" class="twitter" on-tap="_loginTwitter">
              <iron-icon src="/images/twitter-24.png"></iron-icon>
            </paper-button>
          </div>
          <br>
          <paper-button on-click="forgotClick" disabled$="{{wait}}">forgot password?</paper-button>
        </div>
      </paper-material>




      <paper-material wide$="{{wide}}">

        <div class="section user layout vertical center-center">
          <iron-image class="userIcon" src="{{user.profileImageURL}}" alt="user image" fade sizing="cover">
          </iron-image>

          <div class="info">
            <h3 class="header">[[user.displayName]]</h3>
            <div class="subheader">
              <span>[[user.provider]]</span>
            </div>
          </div>
        </div>



        <div class="section addons layout horizontal center-center">

          <template is="dom-if" if="{{_computeAddonProvider(user)}}" restamp="true">
            <paper-button class$="{{user.provider}}" raised disabled>
              <iron-icon src="{{_computeAddonProviderIcon(user)}}" class="icon"></iron-icon>
              <span>{{user.provider}}</span>
            </paper-button>
          </template>

          <paper-button class$="{{user.instagram}}" raised disabled$="{{user.instagram}}" on-tap="_instagramAuthTap" hidden$="{{!user.isAdmin}}">
            <iron-icon src="/images/Glyph_Logo_png.png" class="icon"></iron-icon>
            <span>Instagram</span>
          </paper-button>

        </div>



        <div class="split section layout">

          <div class="address layout vertical flex">

            <div class="header layout vertical center-center">
              Address
            </div>

            <template is="dom-if" if="{{!user.address}}" restamp="true">
              <div class="body layout vertical center-center">
                <paper-icon-button class="edit-action" icon="add" on-tap="_navAddressList"></paper-icon-button>
              </div>
            </template>


            <template is="dom-if" if="{{user.address}}" restamp="true">
              <paper-item>
                <paper-item-body two-line>
                  <div class="line1">
                    <span>[[user.address.add_street]]</span>
                  </div>
                  <div secondary>
                    <span>[[user.address.add_city]]</span>,
                    <span>[[user.address.add_state]]</span>,
                    <span>[[user.address.add_zip]]</span>
                  </div>
                </paper-item-body>
                <paper-icon-button class="edit-action" icon="editor:mode-edit" on-tap="_navAddressList"></paper-icon-button>
              </paper-item>
            </template>

          </div>

          <div class="divider"></div>

          <div class="card layout vertical flex">
            <!-- <iron-icon class="headerIcon" icon="icons:credit-card"></iron-icon> -->
            <div class="header layout vertical center-center">
              Card
            </div>


            <template is="dom-if" if="{{!user.card}}" restamp="true">
              <div class="body layout vertical center-center">
                <paper-icon-button class="edit-action" icon="add" on-tap="_navCardList"></paper-icon-button>
              </div>
            </template>


            <template is="dom-if" if="{{user.card}}" restamp="true">
              <paper-item>
                <paper-item-body>
                  <div class="layout horizontal">
                    <iron-icon class="cc_type margin-right-16" src$="[[_computeTypeIcon(user.card.cc_type)]]"></iron-icon>
                    <div class="cc_end">{{user.card.cc_end}}</div>
                  </div>
                </paper-item-body>
                <paper-icon-button class="edit-action" icon="editor:mode-edit" on-tap="_navAddressList"></paper-icon-button>
              </paper-item>
            </template>

          </div>

        </div>

      </paper-material>

    </iron-pages>

  </template>

  <script>
    (function() {
      Polymer({
        is: 'page-account',
        enableCustomStyleProperties: true,
        properties: {

          // Page

          _page: {
            type: Number,
            notify: true,
            value: 0
          },

          // User
          email: {
            type: String,
            notify: true,
            value: ""
          },
          password: {
            type: String,
            notify: true,
            value: ""
          },
          wait: {
            type: Boolean,
            notify: true,
          },
          loggedin: {
            type: Boolean,
            notify: true
          },
          user: {
            type: Object,
            notify: true,
          },
          provider: {
            type: String,
            value: 'password'
          }

        },

        observers: [
          // '_checkAuth(wait, loggedin)',
          // 'newCardValue(card.*)',
          // 'newAddressValue(address.*)'
          // '_check(Address)',
          '_changePage(loggedin)',
          // 'check(user)',
        ],

        check: function(user) {
          console.log(user);
        },

        _changePage: function(loggedin) {
          // console.info('loggedin: ', loggedin);
          if (loggedin) {
            this._page = 1;
          } else {
            this._page = 0;
          }
        },


        _instagramAuthTap: function() {
          // console.log(window.location);
          // window.location.hostname === "localhost" ?
          var loc = window.location.origin + "/?auth=instagram";
          var opts = 'location=0,status=0,width=800,height=400';
          console.log(loc);
          this.debounce('_instagramAuthTapFFFF', function(argument) {
            var _oauthWindow = window.open('https://api.instagram.com/oauth/authorize/?client_id=f467930444ba4f3a97c21961e74022e8&redirect_uri=' + loc + '&response_type=token' + '&scope=basic', 'Instagram', opts);
          }, 200);

        },

        _computeAccountText: function(loggedin) {
          if (loggedin) {
            return this.user.displayName;
          }
          return 'Account';
        },

        _checkAuth: function(wait, loggedin) {
          // console.log(wait, loggedin);

          if (!loggedin && !wait) {
            console.log('not logged in!');
            this.fire('toast', {
              text: 'Have to be logged in to view page'
            });
            this.debounce('nav_delay', function(argument) {
              this.router.go('/login');
            }, 0);

            return;
          }

          // if (!user) {
          //   this.debounce('nav_delay', function(argument) {
          //     this.router.go('/login');
          //   }, 0);
          // }

        },

        _computeTypeIcon: function(type) {
          return 'bower_components/gold-cc-input/images/' + type + '.png';
        },

        newCardValue: function(card) {
          // console.log(cardRef.val());
          // console.log(card);
          if (card.length === 0) {
            this.noCard = true;
            return;
          }
          for (var i = 0; i < this.card.length; i++) {
            // console.log(this.card[i].default_card);
            if (this.card[i].default_card) {
              this.user.card = this.card[i];
              // console.log(this.defaultCard.cc_name);
              return;
            }
          }
        },

        newAddressValue: function(address) {
          // console.log(cardRef.val());
          // console.log(this.card);
          if (address.length === 0) {
            this.noAddress = true;
            return;
          }

          for (var i = 0; i < this.address.length; i++) {
            // console.log(this.card[i].default_card);
            if (this.address[i].default_address) {
              this.defaultAddress = this.address[i];
              // console.log(this.defaultAddress.add_street);
              return;
            }
          }
        },

        _navCardList: function() {
          // this.fire('nav', {
          //   path: "/account/card"
          // });
          this.fire('open-card-dialog');
        },

        _navAddressList: function() {
          // this.showAddressList = !this.showAddressList;
          // this.fire('nav', {
          //   path: "/account/address"
          // });
          this.fire('open-address-dialog');
        },

        // Login
        _loginPassword: function() {
          this.$.catalogUser.login('password', this.email, this.password);
        },
        _loginGoogle: function() {
          this.$.catalogUser.login('google');
        },
        _loginTwitter: function() {
          this.$.catalogUser.login('twitter');
        },
        _loginFacebook: function() {
          this.$.catalogUser.login('facebook');
        },

        _computeAddonProvider: function(user) {
          return user.provider || 'Secure';

        },
        _computeAddonProviderIcon: function(user) {
          if (user.provider === 'facebook') {
            return '/images/facebook-24.png';
          } else if (user.provider === 'google') {
            return '/images/google.svg';
          } else if (user.provider === 'twitter') {
            return '/images/twitter-24.png';
          }
        }


      });
    })();
  </script>

</dom-module>
